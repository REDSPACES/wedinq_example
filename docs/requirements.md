# 要件定義書

## 1. 概要

### 1.1 プロジェクト名

Wedinq（ウェディンク） - ウェディング向けリアルタイムクイズアプリケーション

### 1.2 目的

結婚式の余興として、ゲスト全員が参加できるリアルタイムクイズを提供する。
新郎新婦に関するクイズを通じて、ゲスト同士の交流と会場の一体感を演出する。

---

## 2. ユーザーロール

### 2.1 管理者（Admin）

事前準備を担当するロール。結婚式の幹事や新郎新婦本人を想定。

**認証方式**: メールアドレス + パスワード（Supabase Auth）

**権限**:

- クイズセットの作成・編集・削除
- クイズ問題の登録・編集・削除・並び替え
- クイズセットに紐づくMC用アクセスコードの発行
- クイズセットに紐づく参加者用アクセスコードの発行

### 2.2 MC（Master of Ceremonies）

クイズ進行を担当するロール。司会者を想定。

**認証方式**: MC専用アクセスコード（8文字）

**権限**:

- セッションの作成
- クイズセッションの開始・終了
- 問題の進行（次の問題へ進める）
- 参加者の回答状況をリアルタイムで確認
- 各問題の結果確認
- 最終結果（上位3名）の確認・発表

**制限**:

- クイズ問題の編集はできない
- クイズセットの削除はできない

### 2.3 参加者（Participant）

クイズに回答するロール。結婚式のゲストを想定。

**認証方式**: 参加者用アクセスコード（6文字）+ 識別コード + ニックネーム

**権限**:

- セッションへの参加
- クイズへの回答
- 自分の回答結果の確認
- 最終結果の確認

---

## 3. 機能要件

### 3.1 クイズ機能

#### 3.1.1 クイズ形式

- **3択問題のみ**対応
- 各問題に選択肢A、B、Cを設定
- 正解は1つのみ

#### 3.1.2 問題数

- 1セッションあたり **5〜10問**（管理者が設定）

#### 3.1.3 制限時間

- 問題ごとに制限時間を設定可能
- デフォルト: 30秒
- 設定範囲: 10秒〜60秒

#### 3.1.4 スコアリング

- 正解時: 基本ポイント（デフォルト100点）を獲得
- 早押しボーナス: 回答が早いほど高得点（最大1.5倍）
- 不正解時: 0点
- 制限時間超過: 0点（回答不可）

※ 詳細な計算式は技術設計書を参照

### 3.2 セッション管理

#### 3.2.1 セッション状態

| 状態     | 説明             |
| -------- | ---------------- |
| waiting  | 参加者待ち受け中 |
| active   | クイズ進行中     |
| finished | 終了             |

### 3.3 リアルタイム同期

#### 3.3.1 同期対象イベント

| イベント         | 送信元 | 受信先 | 内容                       |
| ---------------- | ------ | ------ | -------------------------- |
| session_started  | MC     | 参加者 | セッション開始通知         |
| quiz_started     | MC     | 参加者 | 問題開始（問題データ含む） |
| quiz_ended       | MC     | 参加者 | 問題終了（正解発表）       |
| answer_submitted | 参加者 | MC     | 回答送信（集計用）         |
| session_ended    | MC     | 参加者 | セッション終了（最終結果） |

### 3.4 結果表示

#### 3.4.1 問題ごとの結果

- 正解の選択肢を表示
- 選択肢別の回答分布（MC画面のみ）

#### 3.4.2 最終結果

- **上位3名**のニックネームと得点を表示
- 全参加者のランキング（MC画面のみ）

---

## 4. 画面一覧

### 4.1 共通

- トップページ: ロール選択（参加者/MC/管理者）

### 4.2 参加者向け

- 参加登録: コード入力・ニックネーム登録
- 待機画面: セッション開始待ち
- クイズ画面: 問題表示・回答選択
- 結果画面: 最終結果表示

### 4.3 MC向け

- MC認証: アクセスコード入力
- ダッシュボード: セッション作成・進行管理
- 回答状況: リアルタイム回答状況
- 結果確認: 上位3名・詳細結果

### 4.4 管理者向け

- ログイン: 認証画面
- ダッシュボード: クイズセット一覧
- セット作成: 新規作成
- セット編集: 編集
- 問題管理: 問題CRUD

※ 詳細なパス設計は技術設計書を参照

---

## 5. データモデル

### 5.1 データ構造

```
クイズセット（管理者が作成）
├── クイズ問題（管理者が登録）
├── MC用コード（クイズセットに紐づく）
├── 参加者用コード（クイズセットに紐づく）
└── セッション（MCが作成・進行）
      └── 参加者（参加者コードで参加）
            └── 回答
```

### 5.2 エンティティ

| エンティティ | 説明                               |
| ------------ | ---------------------------------- |
| admins       | 管理者情報                         |
| quiz_sets    | クイズセット                       |
| quizzes      | クイズ問題                         |
| sessions     | クイズセッション                   |
| participants | 参加者                             |
| answers      | 回答                               |

※ 詳細なER図・テーブル定義は技術設計書を参照

---

## 6. 用語集

| 用語           | 説明                                                       |
| -------------- | ---------------------------------------------------------- |
| クイズセット   | 1つのイベント（結婚式）に対応するクイズの集まり            |
| セッション     | クイズセットを実行する単位。同じセットで複数回実施可能     |
| アクセスコード | クイズセットに紐づく認証コード（MC用8文字、参加者用6文字） |
| 識別コード     | 参加者を一意に識別するコード（テーブル番号など、セッション内で重複不可） |
